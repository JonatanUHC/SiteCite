<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste d'objets Minecraft</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <h1>Liste d'objets Minecraft</h1>
    <div id="categories-container">
        <!-- Les catégories et éléments seront remplis dynamiquement depuis le JSON -->
    </div>
    <button id="saveButton">Sauvegarder</button>
    <button id="loadStatsButton">Voir les stats des joueurs</button>

    <script>
        // Variables pour stocker les données initiales
        let initialData = {};

        // Fonction pour charger les données depuis le fichier JSON
        function loadJSON() {
            fetch('/getMinecraftData')
                .then(response => response.json())
                .then(data => {
                    initialData = data;
                    displayCategories(data);
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des données JSON :', error);
                });
        }

        // Fonction pour afficher les catégories de données
        function displayCategories(data) {
            const categoriesContainer = document.getElementById('categories-container');
            categoriesContainer.innerHTML = ''; // Nettoyer les catégories précédentes

            Object.keys(data).forEach(category => {
                const categoryDiv = document.createElement('div');
                const categoryTitle = document.createElement('h2');
                categoryTitle.textContent = category;
                categoryDiv.appendChild(categoryTitle);

                const itemList = document.createElement('ul');

                Object.keys(data[category]).forEach(itemName => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <span>Nom de l'objet : ${itemName}</span>
                        <span>Valeur : <input type="number" class="object-value" data-category="${category}" data-itemname="${itemName}" value="${data[category][itemName]}"></span>
                    `;
                    itemList.appendChild(listItem);
                });

                categoryDiv.appendChild(itemList);
                categoriesContainer.appendChild(categoryDiv);
            });
        }

        // Fonction pour sauvegarder les données modifiées sur le serveur
        function saveData() {
            const objects = document.querySelectorAll(".object-value");
            const updatedData = {};

            objects.forEach(obj => {
                const category = obj.getAttribute('data-category');
                const itemName = obj.getAttribute('data-itemname');
                const itemValue = parseInt(obj.value, 10);

                if (!updatedData[category]) {
                    updatedData[category] = {};
                }

                updatedData[category][itemName] = itemValue;
            });

            fetch('/updateMinecraftData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updatedData),
            })
            .then(response => {
                if (response.ok) {
                    console.log('Données Minecraft mises à jour avec succès.');
                    showNotification('Données sauvegardées avec succès!');
                } else {
                    throw new Error('Erreur lors de la sauvegarde des données.');
                }
            })
            .catch(error => {
                console.error('Erreur lors de la mise à jour des données Minecraft :', error);
                showNotification('Échec de la sauvegarde des données!');
            });
        }

        // Fonction pour afficher une notification
        function showNotification(message) {
            const notification = document.createElement("div");
            notification.className = "notification";
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }

        // Fonction pour charger et afficher les statistiques des joueurs
        function loadPlayerStats() {
            fetch('/getAllPlayerStats')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erreur réseau: Le serveur a répondu avec un statut ${response.status}`);
                    }
                    return response.json();
                })
                .then(stats => {
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write('<h1>Stats des joueurs</h1>');
                    newWindow.document.write('<pre>' + JSON.stringify(stats, null, 2) + '</pre>');
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des stats des joueurs :', error);
                    alert('Erreur lors du chargement des stats des joueurs. Vérifiez la console pour plus de détails.');
                });
        }

        // Attacher les gestionnaires d'événements après le chargement du contenu de la page
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('saveButton').addEventListener('click', saveData);
            document.getElementById('loadStatsButton').addEventListener('click', loadPlayerStats);
        });

        // Charger les données JSON au chargement de la page
        loadJSON();
    </script>
</body>
</html>
